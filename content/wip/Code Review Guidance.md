- **Metadata**
- [[Code]]
- [[Code Review]]
- [[Blogging]] [[Medium]]
- [[Work]] [[Skyscanner]]
- Last Updated: [[2020-07-10]]
- Summary: Some draft ideas of what I'd like to write about empathetic code reviews. This is partially for the code review guild and also partially for a medium blog I'd like to write. 


- Links
    - [Confluence Doc](https://confluence.skyscannertools.net/display/BIRP/WIP%3A+Review+Comments+Best+Practice)
    - [Slack Advice](https://slack.engineering/how-about-code-reviews-2695fb10d034)
- Highlighted is stuff to add to "Code Review Best Practices"
- WIP Title: Empathetic Code Review
    - Reviewing code is not a distraction from your job - it is your job
    - Everyone in the team is responsible for elevating the standard of the code in your code base
    - Compassionate code reviews - “is it true? Is it necessary? Is it kind?” - https://www.slideshare.net/AprilWensel/compassionate-yet-candid-code-reviews
    - Constructive reviews + use Github’s “code suggestion” (Cmd + g) - https://chelseatroy.com/2019/12/18/reviewing-pull-requests/
        - Why PRs are shit and pairing to review code is awesome
            - When you pair you get moments like - this works because it's synchronous
                - A: "what if we tried it like this?"
                - B: "hmm that's interesting let's try it"
                - A: "mind if I grab the keyboard? I think if we did this, it might be more elegant" 
            - When you do this asynchronously you get the PR review process
                - This is a different animal
                - There is a lot of vagity, "Yea i think something like this is better" <random puesdocode that doesn't compile>, you get the gist
                - Or worse - "this doesnt work, do this instead" - *blocks merge*
            - The difference between the two is really the level of investment on the part of the reviewer
                - Reviewers need to be active participants. Not just dispensing dubious knowledge from atop an ivory tower. 
                    - At a bare minimum you must:
                        - Read **and understand** every line being changed
                        - pull the code down to verify it runs locally and tests pass - CI/CD pipelines can help here. With those set up you can at least verify the tests are passing 
                - Reviewers: put your money where your mouth is.
                    - If you don't like something about the code, pull it down and try an alternative. This aids effective context transfer 
                    - If you feel like actually pushing code back up is disrespectful at least offer suggestions that actual run, copy pastable code. Verify this for yourself locally. Use github's code suggestion feature.
    - ==Building up a shared vocabulary that all engineers understand - e.g. using sources like Fowler’s Refactoring (which most people have read, or at least are familiar with the ideas) - [https://martinfowler.com/books/refactoring.htm](https://martinfowler.com/books/refactoring.html)==
    - ==The Platinum Rule - "Treat others as they would like to be treated".==
        - ==Code review can be useful beyond catching bugs or improving code quality before it is merged into production==
        - You might want to tailor how you approach giving your advice depending on the PR author. Some illustrative examples:
            - New Grad: Walk through the logic behind the comment, referencing educational material (e.g. https://refactoring.guru/) to help them understand both the "what" and the "why". In doing so you're both improving the code quality and upskilling a colleague.
            - New Joiner: In this case they are going to be unfamiliar with the code base. It might be helpful to accompany your suggestions with context around how this logic sits within the codebase, or indeed the larger ecosystem of your area. An example might be showing them patterns which exist in the codebase that they might have overlooked.
            - Experienced Colleague: In this case you can assume they are familiar with the code base.  You might feel more comfortable giving direct feedback here or pointing to examples in other code bases you've both worked on to suggest an approach.
        - Other aspects you might want to consider - is this person new to the language, is this person new to the codebase (for example an open source contribution), or (if you're fortunate enough to work with an international team) is this person's first language not the predominant language being used in most discussions on the repo.
    - [Palantir Review Best Practices](https://medium.com/palantir/code-review-best-practices-19e02780015f)
        - Reviews should be
            - ==Concise==
            - ==Friendly==
            - ==Written in a neutral language==
        - ==Avoid possessive pronouns - E.g. "**my** code worked before this change" or "**your** method is buggy"==
        - ==Avoid absolutes - E.g. "This will **never** work"==
        - ==Try to differentiate between suggestions, requirements, nits and points for further discussion in your comments.==
            - Suggestions - "Suggestion: Move these methods to a new class to follow SRP"
            - Requirements - "Add @Override annotation here please"
            - Nit - "getUtid() rather than utidGetter() to be consistent with other getters in the project"
            - Further Discussion - "Can you explain why we order items this why in the collection?"
        - ==It's on the reviewer to be clear on how to move the PR along the review process==
            - If the author can merge after cleaning up a couple of nit comments then the reviewer should clearly state this.
            - Equally, if they would need to take a second look at more significant changes, they should suggest when they'd be able to do so.
    - Slack Review Best Practices 
        - Good code reviews require understanding, if you don't understand the code being changed you need to read the current version. If you still don't understand, ask questions or find some clarifying documentation. If it's the case that what's being change still doesn't make sense, then you should pass up the review to let someone else take a look instead. 
        - ^^Talking about the changes holistically and bringing up edge cases are some of the most valuable things you can contribute. ^^
            - **Some of the best comments I've received have not be suggesting any one individual change but rather a summary of the "why" which has forced me to raise up the level of abstraction and think more deeply about the changed I'm proposing**
        - ^^Good code reviews share knowledge - this is similar to what's there in the "Platinum Rule". Share knowledge, reference existing code, old bug tickets etc ^^
        - ^^Know when the code review is not the place to have this conversation. ^^
            - Code reviews are typically asynchronous, which is great if you have some small suggestions but are otherwise happy with the change being suggested 
            - When this asynchronous nature is not great, is when you have a fundamental disagreement with one or all of the changes proposed. 
                - Side note: if you are regularly finding that a change is being suggested which makes no sense and should really be closed or completely rewritten it might be worth considering how this happened? People's time is too valuable to waste like this, not to mention it's demotivating. 
                    - Ideally everyone should be both aware and aligned on the work that is happening daily. This is what daily standups are for.
                - You should always ask yourself if this wouldn't be more quickly resolved by a face to face conversation, a video call or a conversation over IM
        - ==Good code reviews have empathy==
            - When you see a problem with the code, try to put yourself in their shoes 
            - ^^Also I would default to the mindset that it is you that's missing something. They have been deeply involved with this change, they may know something you don't. ^^
                - ^^For this reason, unless something is really obviously wrong like `if(x = 0) { ... }` you should phrase your suggestion as a question. ^^
                    - "should this be ...?"
                    - "have you thought about X pattern here?"
                    - "what happens if this method returns null?"
    - ==Have a PR template==
        - wait this has nothing to do with empathy?!
        - exactly - a PR template means noone on the team needs to be the person that points out that this code isn't tested, that there is no context behind the change, there is no link to the story ticket etc.. 
            - PR templates vary a lot but the great ones I've seen have the following sections
                - link to the user story ticket  - I'm assuming you're using Jira, Asana, Trello or Github Issues 
                - Context - the why and a little bit of the how behind this change. I view this section as the place where the user story's acceptance criteria is solidified in what actually needs to happen in the code base. 
                - tests yes/no (you might want to split this out into unit, integration, E2E - and no we wont get into a fight about where to draw the line between these 3 categories)
    - ==Use a linter==
        - This might be more controversial because first you have to agree on a linting standard BUT
        - Logic is the same as the above, you don't need to be the person that comments everywhere that the indentation is off, or this method is using camel casing but everywhere else we use snake casing
        - Why should we care about this?
            - Good code is readable - readable code is visually consistent. 
